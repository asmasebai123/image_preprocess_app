<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ImageLab Pro - Plateforme de Prétraitement d'Images</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <!-- Modale pour l'histogramme plein écran - HORS DU LAYOUT PRINCIPAL -->
    <div class="histogram-modal" id="histogram-modal" >
        <div class="modal-overlay"></div>
        <div class="modal-container">
            <div class="modal-header">
                <h2>
                    <i class="fas fa-chart-bar"></i>
                    Histogramme détaillé
                </h2>
                <button class="modal-close" id="modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-content">
                <div class="modal-controls">
                    <div class="modal-channel-selector">
                        <button class="channel-btn active" data-channel="rgb">
                            <i class="fas fa-palette"></i> Tous les canaux
                        </button>
                        <button class="channel-btn" data-channel="red">
                            <i class="fas fa-circle" style="color: #ff4444;"></i> Rouge
                        </button>
                        <button class="channel-btn" data-channel="green">
                            <i class="fas fa-circle" style="color: #44ff44;"></i> Vert
                        </button>
                        <button class="channel-btn" data-channel="blue">
                            <i class="fas fa-circle" style="color: #4444ff;"></i> Bleu
                        </button>
                        <button class="channel-btn" data-channel="gray">
                            <i class="fas fa-circle" style="color: #cccccc;"></i> Niveaux de gris
                        </button>
                        <button class="channel-btn" id="modal-equalize-btn">
                            <i class="fas fa-chart-line"></i> Égaliser
                        </button>
                    </div>
                    
                    <div class="modal-zoom-controls">
                        <button class="zoom-btn" id="modal-zoom-in">
                            <i class="fas fa-search-plus"></i>
                        </button>
                        <button class="zoom-btn" id="modal-zoom-out">
                            <i class="fas fa-search-minus"></i>
                        </button>
                        <button class="zoom-btn" id="modal-zoom-reset">
                            <i class="fas fa-expand-arrows-alt"></i>
                        </button>
                    </div>
                </div>
                
                <div class="modal-histogram-container">
                    <canvas id="modal-histogram-canvas"></canvas>
                </div>
                
                <div class="modal-statistics">
                    <div class="stat-grid">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-image"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-label">Pixels totaux</span>
                                <span class="stat-value" id="modal-total-pixels">0</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-calculator"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-label">Moyenne</span>
                                <span class="stat-value" id="modal-mean-value">0</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-label">Écart-type</span>
                                <span class="stat-value" id="modal-std-value">0</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-arrows-alt-h"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-label">Dynamique</span>
                                <span class="stat-value" id="modal-dynamic-range">0-255</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-filter"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-label">Entropie</span>
                                <span class="stat-value" id="modal-entropy">0</span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-balance-scale"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-label">Contraste</span>
                                <span class="stat-value" id="modal-contrast">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="histogram-details">
                        <h3><i class="fas fa-info-circle"></i> Informations détaillées</h3>
                        <div class="details-grid">
                            <div class="detail-item">
                                <span class="detail-label">Canal actif:</span>
                                <span class="detail-value" id="modal-active-channel">RGB</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Image:</span>
                                <span class="detail-value" id="modal-image-info">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Niveau min:</span>
                                <span class="detail-value" id="modal-min-level">0</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Niveau max:</span>
                                <span class="detail-value" id="modal-max-level">255</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Médiane:</span>
                                <span class="detail-value" id="modal-median">0</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Mode:</span>
                                <span class="detail-value" id="modal-mode">0</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button class="action-btn" id="modal-save-btn">
                        <i class="fas fa-download"></i> Sauvegarder l'histogramme
                    </button>
                    <button class="action-btn secondary" id="modal-print-btn">
                        <i class="fas fa-print"></i> Imprimer
                    </button>
                    <button class="action-btn secondary" id="modal-reset-btn">
                        <i class="fas fa-redo"></i> Réinitialiser la vue
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay - HORS DU LAYOUT PRINCIPAL -->
    <div class="loading-overlay" id="loading-overlay" style="display: none;">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Chargement en cours...</p>
        </div>
    </div>

    <!-- LAYOUT PRINCIPAL SEULEMENT ICI -->
    <div class="app-container">
        <!-- Header -->
        <header>
            <div class="logo">
                <i class="fas fa-sliders-h logo-icon"></i>
                <span class="logo-text">ImageLab Pro</span>
            </div>
            <div class="header-actions">
                <button class="theme-toggle">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </header>

        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="nav-item active" data-section="adjustments">
                <i class="fas fa-sliders-h nav-icon"></i>
                <span class="nav-label">Ajustements</span>
            </div>
            <div class="nav-item" data-section="filters">
                <i class="fas fa-filter nav-icon"></i>
                <span class="nav-label">Filtres</span>
            </div>
            <div class="nav-item" data-section="transform">
                <i class="fas fa-crop-alt nav-icon"></i>
                <span class="nav-label">Transformations</span>
            </div>
            <div class="nav-item" data-section="threshold">
                <i class="fas fa-border-all nav-icon"></i>
                <span class="nav-label">Seuillage</span>
            </div>
            <div class="nav-item" data-section="channels">
                <i class="fas fa-object-group nav-icon"></i>
                <span class="nav-label">Canaux</span>
            </div>
            <div class="nav-item" data-section="detection">
                <i class="fas fa-draw-polygon nav-icon"></i>
                <span class="nav-label">Détection contours</span>
            </div>
            <div class="nav-item" data-section="histogram">
                <i class="fas fa-chart-bar nav-icon"></i>
                <span class="nav-label">Histogramme</span>
            </div>
            <div class="nav-item" data-section="export">
                <i class="fas fa-download nav-icon"></i>
                <span class="nav-label">Exporter</span>
            </div>
        </nav>

        <!-- Zone principale -->
        <main class="main-content">
            <div class="image-preview-container">
                <img id="preview-image" class="image-preview" src="" alt="Aperçu de l'image">
                <div class="placeholder-content" id="placeholder">
                    <i class="fas fa-cloud-upload-alt upload-icon"></i>
                    <h2 class="placeholder-text">Glissez-déposez une image ou importez depuis votre appareil</h2>
                    <button class="upload-btn" id="upload-trigger">
                        <i class="fas fa-folder-open"></i> Importer une image
                    </button>
                    <input type="file" id="file-input" accept="image/*" style="display: none;">
                </div>
                <div class="image-overlay">
                    <div class="zoom-controls">
                        <button class="zoom-btn" id="zoom-in"><i class="fas fa-search-plus"></i></button>
                        <button class="zoom-btn" id="zoom-out"><i class="fas fa-search-minus"></i></button>
                        <button class="zoom-btn" id="zoom-reset"><i class="fas fa-expand-arrows-alt"></i></button>
                    </div>
                    <div class="image-info-overlay">
                        <span id="image-dimensions">-</span>
                        <span id="image-size">-</span>
                    </div>
                </div>
            </div>
            <div class="image-controls">
                <button class="control-btn" id="undo-btn">
                    <i class="fas fa-undo"></i> Annuler
                </button>
                <button class="control-btn" id="redo-btn">
                    <i class="fas fa-redo"></i> Rétablir
                </button>
                <button class="control-btn" id="reset-btn">
                    <i class="fas fa-sync-alt"></i> Réinitialiser
                </button>
                <button class="control-btn" id="compare-btn">
                    <i class="fas fa-eye"></i> Comparer
                </button>
                <button class="control-btn" id="save-btn">
                    <i class="fas fa-save"></i> Sauvegarder
                </button>
            </div>
        </main>

        <!-- Panneau droit -->
        <aside class="right-panel">
            <!-- Section des ajustements de base -->
            <div class="panel-section active" id="adjustments-section">
                <h3 class="section-title">
                    <i class="fas fa-sliders-h section-icon"></i> Ajustements de base
                </h3>
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Luminosité</span>
                        <span class="slider-value">0</span>
                    </div>
                    <input type="range" min="-100" max="100" value="0" class="slider" id="brightness-slider">
                </div>
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Contraste</span>
                        <span class="slider-value">0</span>
                    </div>
                    <input type="range" min="-100" max="100" value="0" class="slider" id="contrast-slider">
                </div>
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Niveaux de gris</span>
                        <span class="slider-value">0%</span>
                    </div>
                    <input type="range" min="0" max="100" value="0" class="slider" id="grayscale-slider">
                </div>
            </div>

            <!-- Section des filtres -->
            <div class="panel-section" id="filters-section">
                <h3 class="section-title">
                    <i class="fas fa-filter section-icon"></i> Filtres
                </h3>
                <div class="filters-grid">
                    <div class="filter-card" data-filter="gaussian">
                        <div class="filter-preview gaussian"></div>
                        <span class="filter-name">Gaussien</span>
                    </div>
                    <div class="filter-card" data-filter="average">
                        <div class="filter-preview average"></div>
                        <span class="filter-name">Average</span>
                    </div>
                    <div class="filter-card" data-filter="median">
                        <div class="filter-preview median"></div>
                        <span class="filter-name">Médiane</span>
                    </div>
                    <div class="filter-card" data-filter="bilateral">
                        <div class="filter-preview bilateral"></div>
                        <span class="filter-name">Bilateral</span>
                    </div>
                    <div class="filter-card" data-filter="motion">
                        <div class="filter-preview motion"></div>
                        <span class="filter-name">Motion Blur</span>
                    </div>
                    <div class="filter-card" data-filter="sharpen">
                        <div class="filter-preview sharpen"></div>
                        <span class="filter-name">Accentuation</span>
                    </div>
                </div>
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Intensité du filtre</span>
                        <span class="slider-value">3</span>
                    </div>
                    <input type="range" min="1" max="10" value="3" class="slider" id="filter-intensity-slider">
                </div>
            </div>

            <!-- Section des transformations -->
            <div class="panel-section" id="transform-section">
                <h3 class="section-title">
                    <i class="fas fa-crop-alt section-icon"></i> Transformations
                </h3>
                <div class="transform-controls">
                    <button class="transform-btn" id="rotate-left">
                        <i class="fas fa-undo"></i> -90°
                    </button>
                    <button class="transform-btn" id="rotate-right">
                        <i class="fas fa-redo"></i> +90°
                    </button>
                    <button class="transform-btn" id="flip-horizontal">
                        <i class="fas fa-arrows-alt-h"></i> Miroir H
                    </button>
                    <button class="transform-btn" id="flip-vertical">
                        <i class="fas fa-arrows-alt-v"></i> Miroir V
                    </button>
                </div>
                <div class="custom-rotation">
                    <div class="rotation-input-group">
                        <input type="number" id="rotation-angle" class="rotation-input" placeholder="Angle en degrés" min="-360" max="360">
                        <button class="rotation-btn" id="apply-rotation">
                            <i class="fas fa-sync-alt"></i> Appliquer
                        </button>
                    </div>
                </div>
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Redimensionnement</span>
                        <span class="slider-value">100%</span>
                    </div>
                    <input type="range" min="10" max="200" value="100" class="slider" id="resize-slider">
                </div>
            </div>

            <!-- Section du seuillage -->
            <div class="panel-section" id="threshold-section">
                <h3 class="section-title">
                    <i class="fas fa-border-all section-icon"></i> Seuillage
                </h3>
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Seuil</span>
                        <span class="slider-value">128</span>
                    </div>
                    <input type="range" min="0" max="255" value="128" class="slider" id="threshold-slider">
                </div>
                <div class="threshold-types">
                    <button class="threshold-btn active" data-type="binary">Binaire</button>
                    <button class="threshold-btn" data-type="adaptive">Adaptatif</button>
                    <button class="threshold-btn" data-type="otsu">Otsu</button>
                </div>
            </div>

            <!-- Section de séparation des canaux -->
            <div class="panel-section" id="channels-section">
                <h3 class="section-title">
                    <i class="fas fa-object-group section-icon"></i> Séparation des canaux
                </h3>
                <div class="channels-controls">
                    <button class="channel-btn" id="channel-r">
                        <i class="fas fa-square" style="color: #ff6b6b;"></i> Canal Rouge
                    </button>
                    <button class="channel-btn" id="channel-g">
                        <i class="fas fa-square" style="color: #51cf66;"></i> Canal Vert
                    </button>
                    <button class="channel-btn" id="channel-b">
                        <i class="fas fa-square" style="color: #339af0;"></i> Canal Bleu
                    </button>
                    <button class="channel-btn" id="channel-all">
                        <i class="fas fa-th"></i> Tous les canaux
                    </button>
                </div>
            </div>

            <!-- Section de détection de contours -->
            <div class="panel-section" id="detection-section">
                <h3 class="section-title">
                    <i class="fas fa-draw-polygon section-icon"></i> Détection de contours
                </h3>
                <div class="detection-controls">
                    <button class="detection-btn active" data-detector="canny">Canny</button>
                    <button class="detection-btn" data-detector="sobel">Sobel</button>
                    <button class="detection-btn" data-detector="laplacian">Laplacien</button>
                </div>
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Seuil bas</span>
                        <span class="slider-value">50</span>
                    </div>
                    <input type="range" min="0" max="255" value="50" class="slider" id="low-threshold-slider">
                </div>
                <div class="slider-container">
                    <div class="slider-label">
                        <span>Seuil haut</span>
                        <span class="slider-value">150</span>
                    </div>
                    <input type="range" min="0" max="255" value="150" class="slider" id="high-threshold-slider">
                </div>
            </div>

            <!-- Section de l'histogramme -->
            <div class="panel-section" id="histogram-section">
                <h3 class="section-title">
                    <i class="fas fa-chart-bar section-icon"></i> Histogramme des Intensités
                </h3>
                
                <div class="histogram-controls">
                    <button class="histogram-btn active" data-channel="rgb">
                        <i class="fas fa-palette"></i> Tous
                    </button>
                    <button class="histogram-btn" data-channel="red">
                        <i class="fas fa-circle" style="color: #ff4444;"></i> Rouge
                    </button>
                    <button class="histogram-btn" data-channel="green">
                        <i class="fas fa-circle" style="color: #44ff44;"></i> Vert
                    </button>
                    <button class="histogram-btn" data-channel="blue">
                        <i class="fas fa-circle" style="color: #4444ff;"></i> Bleu
                    </button>
                    <button class="histogram-btn" data-channel="gray">
                        <i class="fas fa-circle" style="color: #cccccc;"></i> Niveaux de gris
                    </button>
                    <button class="histogram-btn" data-channel="equalize">
                        <i class="fas fa-chart-line"></i> Égaliser
                    </button>
                </div>
                
                <div class="histogram-canvas-container" id="histogram-container">
                    <canvas id="histogram-canvas"></canvas>
                    <div class="histogram-overlay" id="histogram-overlay">
                        <i class="fas fa-expand-alt"></i>
                        <span>Cliquez pour agrandir l'histogramme</span>
                    </div>
                </div>
                
                <!-- Légende -->
                <div class="histogram-legend">
                    <div class="legend-item">
                        <div class="legend-color red"></div>
                        <span>Canal Rouge</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color green"></div>
                        <span>Canal Vert</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color blue"></div>
                        <span>Canal Bleu</span>
                    </div>
                </div>
                
                <!-- Statistiques -->
                <div class="histogram-stats" id="histogram-stats">
                    <div class="stat-item">
                        <span>Pixels:</span>
                        <span class="stat-value" id="pixel-count">0</span>
                    </div>
                    <div class="stat-item">
                        <span>Moyenne:</span>
                        <span class="stat-value" id="mean-value">0</span>
                    </div>
                    <div class="stat-item">
                        <span>Écart-type:</span>
                        <span class="stat-value" id="std-value">0</span>
                    </div>
                    <div class="stat-item">
                        <span>Dynamique:</span>
                        <span class="stat-value" id="dynamic-range">0-255</span>
                    </div>
                </div>
                
                <div style="margin-top: 15px; font-size: 12px; color: var(--accent); text-align: center;">
                    <i class="fas fa-lightbulb"></i> L'histogramme montre la distribution des intensités de pixels dans l'image
                </div>
            </div>

            <!-- Section d'exportation -->
            <div class="panel-section" id="export-section">
                <h3 class="section-title">
                    <i class="fas fa-download section-icon"></i> Exportation
                </h3>
                <div class="export-controls">
                    <button class="export-btn" id="export-png">
                        <i class="fas fa-file-image"></i> PNG
                    </button>
                    <button class="export-btn" id="export-jpg">
                        <i class="fas fa-file-image"></i> JPG
                    </button>
                    <button class="export-btn" id="export-tiff">
                        <i class="fas fa-file-image"></i> TIFF
                    </button>
                </div>
                <div class="quality-control">
                    <div class="slider-label">
                        <span>Qualité</span>
                        <span class="slider-value">95%</span>
                    </div>
                    <input type="range" min="1" max="100" value="95" class="slider" id="quality-slider">
                </div>
            </div>

            <!-- Miniature de l'image originale -->
            <div class="original-image-preview">
                <h4 class="original-title">Image Originale</h4>
                <div class="original-container">
                    <img id="original-preview" src="" alt="Image originale" style="display: none;">
                    <div class="original-placeholder" id="original-placeholder">
                        <i class="fas fa-image"></i>
                        <span>Aucune image</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Footer -->
        <footer>
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span id="status-text">Prêt à traiter</span>
            </div>
            <div class="app-version">
                <span>ImageLab Pro v1.0</span>
            </div>
        </footer>
    </div>

    <script src="/static/js/main.js"></script>
</body>
</html>